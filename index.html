<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Модель помещения</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body { 
				margin: 0; 
				overflow: hidden; 
				background-color: #D3D3D3;
			}
			#info {
				position: absolute;
				top: 10px;
				width: 100%;
				text-align: center;
				color: white;
				font-family: Arial, sans-serif;
				z-index: 100;
				text-shadow: 1px 1px 2px black;
			}
		</style>
	</head>
	<body>
		<div id="info">Модель помещения</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>

		<script>
			let camera, scene, renderer, controls;

			init();
			animate();

			function init() {
				// Сцена
				scene = new THREE.Scene();
				scene.background = new THREE.Color(0xD3D3D3);

				// Камера
				camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
				camera.position.set(0, 0, 3000);

				// Рендерер
				renderer = new THREE.WebGLRenderer({ antialias: true });
				renderer.setSize(window.innerWidth, window.innerHeight);
				document.body.appendChild(renderer.domElement);

				// Освещение
				const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
				scene.add(ambientLight);

				const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
				directionalLight.position.set(1, 1, 1);
				scene.add(directionalLight);

				// Элементы управления
				controls = new THREE.OrbitControls(camera, renderer.domElement);
				controls.enableDamping = true;
				controls.dampingFactor = 0.05;

				// Создаем комнату
				createRoom();

				// Добавляем модель учителя
				loadTeacher();

				// Обработчик изменения размера окна
				window.addEventListener('resize', onWindowResize);
			}

			function createRoom() {
				const textureLoader = new THREE.TextureLoader();
				
				// Массив для материалов комнаты
				const materials = [];
				
				// Правильные названия файлов для каждой стороны комнаты
				const textureUrls = [
					'models/whall.jpg',        // правая стена (X+)
					'models/instruments.jpg',  // левая стена (X-) - инструменты
					'models/roof.jpg',         // потолок (Y+)
					'models/floor.jpg',        // пол (Y-)
					'models/window.jpg',       // передняя стена (Z+)
					'models/shelfs.jpg'        // задняя стена (Z-)
				];

				let loadedTextures = 0;
				const totalTextures = 6;

				// Загружаем каждую текстуру
				for (let i = 0; i < totalTextures; i++) {
					const texture = textureLoader.load(
						textureUrls[i],
						// Функция успешной загрузки
						function() {
							loadedTextures++;
							console.log('Текстура загружена: ' + textureUrls[i] + ' (' + loadedTextures + '/' + totalTextures + ')');
							
							// Если все текстуры загружены, создаем комнату
							if (loadedTextures === totalTextures) {
								createRoomMesh(materials);
							}
						},
						// Функция прогресса загрузки
						undefined,
						// Функция ошибки
						function(error) {
							console.error('Ошибка загрузки текстуры:', textureUrls[i], error);
							// Создаем цветной материал вместо текстуры
							const colors = [0x888888, 0x666666, 0xAAAAAA, 0x964B00, 0x87CEEB, 0x556B2F];
							materials[i] = new THREE.MeshBasicMaterial({ 
								color: colors[i], 
								side: THREE.BackSide 
							});
							loadedTextures++;
							
							if (loadedTextures === totalTextures) {
								createRoomMesh(materials);
							}
						}
					);

					const material = new THREE.MeshBasicMaterial({ 
						map: texture, 
						side: THREE.BackSide 
					});
					
					// Настройки для текстуры пола
					if (i === 3) { // пол
						texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
						texture.repeat.set(3, 3);
					}
					
					materials.push(material);
				}
			}

			function createRoomMesh(materials) {
				console.log('Создаем геометрию комнаты');
				
				// Создаем геометрию комнаты
				const roomGeometry = new THREE.BoxGeometry(5000, 5000, 5000);
				const room = new THREE.Mesh(roomGeometry, materials);
				scene.add(room);
				console.log('Комната создана');
			}

			function loadTeacher() {
				const onProgress = function(xhr) {
					if (xhr.lengthComputable) {
						const percentComplete = xhr.loaded / xhr.total * 100;
						console.log('Модель учителя: ' + percentComplete.toFixed(2) + '% загружено');
					}
				};

				const mtlLoader = new THREE.MTLLoader();
				mtlLoader.setPath('https://threejs.org/examples/models/obj/male02/');
				mtlLoader.load('male02.mtl', function(materials) {
					materials.preload();

					const objLoader = new THREE.OBJLoader();
					objLoader.setMaterials(materials);
					objLoader.setPath('https://threejs.org/examples/models/obj/male02/');
					objLoader.load('male02.obj', function(object) {
						object.position.set(-1500, -2400, -200);
						object.rotation.y = Math.PI / 2;
						object.scale.setScalar(10);
						scene.add(object);
						console.log('Модель учителя загружена');
					}, onProgress);
				});
			}

			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize(window.innerWidth, window.innerHeight);
			}

			function animate() {
				requestAnimationFrame(animate);
				controls.update();
				renderer.render(scene, camera);
			}
		</script>
	</body>
</html>


